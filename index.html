<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hex String to Grayscale Image</title>
    <style>
        #canvas {
            border: 1px solid black;
            image-rendering: pixelated;
        }
        #image-container {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <h1>Hex String to Grayscale Image</h1>
    <div>
        <label for="hexInput">Enter Hex String (2 hex digits per pixel):</label><br>
        <textarea id="hexInput" rows="4" cols="50"></textarea><br><br>
        <button onclick="generateImage()">Generate Image</button>
    </div>

    <div id="image-container">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        function generateImage() {
            const hexInput = document.getElementById("hexInput").value.trim();
            
            const cleanedHexInput = hexInput.replace(/\s+/g, '');
            if (cleanedHexInput.length % 2 !== 0) {
                alert("Invalid input: Hex string length must be even (2 hex digits per pixel).");
                return;
            }

            const byteArray = [];

            // Convert the hex string into byte values (0-255)
            for (let i = 0; i < cleanedHexInput.length; i += 2) {
                const hexByte = cleanedHexInput.slice(i, i + 2);
                const byteValue = parseInt(hexByte, 16);
                byteArray.push(byteValue);
            }

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            // Set image size (assuming square image)
            const numPixels = byteArray.length;
            const width = Math.sqrt(numPixels);
            const height = width;

            // Check if the input hex string forms a perfect square
            if (!Number.isInteger(width)) {
                alert("Invalid input: The number of pixels must form a perfect square.");
                return;
            }

            canvas.width = width;
            canvas.height = height;

            canvas.style.width = (width * 10) + "px"; 
            canvas.style.height = (height * 10) + "px";

            // Create image data and fill with grayscale values from the hex input
            const imageData = ctx.createImageData(width, height);
            for (let i = 0; i < byteArray.length; i++) {
                const grayscale = byteArray[i];
                const idx = i * 4;
                imageData.data[idx] = grayscale;     // R
                imageData.data[idx + 1] = grayscale; // G
                imageData.data[idx + 2] = grayscale; // B
                imageData.data[idx + 3] = 255;       // A (full opacity)
            }

            // Put the image data onto the canvas
            ctx.putImageData(imageData, 0, 0);
        }
    </script>
</body>
</html>
